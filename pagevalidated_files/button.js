
var Try={these:function(){var a;for(var b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(e){}}return a}},Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},request:function(a,b,c){var d=this.getTransport();if(!d)return;if(null!==b&&"function"==typeof b)b.onSuccess=b;else if(!b.onSuccess)return!1;var e=c?"post":b.method?b.method:"get";d.open(e,a,!0),d.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest");if(b.headers)for(header in b.headers)d.setRequestHeader("X-"+header,b.headers[header]);e=="post"&&d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.onreadystatechange=function(){if(d.readyState!=4)return;if(d.status!=200&&d.status!=304){b.onFailure&&b.onFailure(d.status,d.responseText);return}b.onSuccess(d.responseText)};if(d.readyState==4)return;return d.send(c),!0}},FlattrButton={doFlattr:function(a){var b={method:"post",onSuccess:function(b){window.parent.postMessage(JSON.stringify({flattr_button_event:"click_successful"}),"*");var c=document.querySelector(".flattr-count span"),d=parseInt(c.innerHTML)||0;c.innerHTML=++d,a.className="flattr flattr-ed",a.querySelector("span.flattr-link").className="flattr-flattred";var e=a.href.match(/^(.+)\/flattr\/(.+)$/i);a.href=e[1]+"/subscribe/"+e[2],a.title="Subscribe"},onFailure:function(a,b){if(!window.useEvents&&(a==401||a==402)){b=JSON.parse(b),window.parent.location.href=b.url;return}if(a==401||a==402){window.parent.postMessage(JSON.stringify({flattr_button_event:"unauthorized"}),"*");return}window.location.reload(!0)}};Ajax.request(a.href,b)||window.location.reload(!0)},doSubscribe:function(a){var b={method:"post",onSuccess:function(b){window.parent.postMessage(JSON.stringify({flattr_button_event:"subscribe_successful"}),"*");var c=document.createElement("span");c.className="flattr-subscribed";var d=document.createElement("span");d.className="flattr",d.appendChild(c),a.parentNode.replaceChild(d,a)},onFailure:function(a,b){window.location.reload(!0)}};Ajax.request(a.href,b)},init:function(){if(!document.querySelectorAll){var a=document.getElementsByTagName("div")[0];a.parentNode.removeChild(a);return}var b,c,d=document.querySelectorAll(".flattr");for(b=0,c=d.length;b<c;b++)d[b].onclick=function(){return/\bflattr-ajax\b/.test(this.className)?FlattrButton.doFlattr(this):/\bflattr-ed\b/.test(this.className)&&FlattrButton.doSubscribe(this),!1}}};window.onload=function(){FlattrButton.init()}